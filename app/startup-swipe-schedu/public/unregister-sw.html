<!DOCTYPE html>
<html>
<head>
  <title>Unregister Service Worker</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    button {
      background: #0066cc;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover { background: #0052a3; }
    .success { color: #22c55e; font-weight: bold; }
    .error { color: #ef4444; font-weight: bold; }
    .info { color: #666; margin: 15px 0; }
    pre {
      background: #f8f8f8;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ”§ Service Worker Unregistration</h1>
    
    <p class="info">
      This page will help you unregister the old service worker that's causing CORS errors.
    </p>

    <button onclick="unregisterAll()">1. Unregister Service Workers</button>
    <button onclick="clearCache()">2. Clear All Caches</button>
    <button onclick="reloadApp()">3. Reload App</button>
    
    <div id="output" style="margin-top: 20px;"></div>

    <hr style="margin: 30px 0;">
    
    <h3>Or Run This in Console:</h3>
    <pre>navigator.serviceWorker.getRegistrations().then(regs => {
  regs.forEach(r => r.unregister());
  caches.keys().then(keys => 
    Promise.all(keys.map(k => caches.delete(k)))
  ).then(() => location.reload());
});</pre>
  </div>

  <script>
    const output = document.getElementById('output');

    function log(message, type = 'info') {
      const p = document.createElement('p');
      p.className = type;
      p.textContent = message;
      output.appendChild(p);
    }

    async function unregisterAll() {
      output.innerHTML = '';
      log('ðŸ” Checking for service workers...');
      
      try {
        const registrations = await navigator.serviceWorker.getRegistrations();
        
        if (registrations.length === 0) {
          log('âœ… No service workers found', 'success');
          return;
        }

        log(`Found ${registrations.length} service worker(s)`, 'info');
        
        for (const registration of registrations) {
          await registration.unregister();
          log(`âœ… Unregistered: ${registration.scope}`, 'success');
        }
        
        log('âœ… All service workers unregistered!', 'success');
      } catch (error) {
        log(`âŒ Error: ${error.message}`, 'error');
      }
    }

    async function clearCache() {
      output.innerHTML = '';
      log('ðŸ” Checking for caches...');
      
      try {
        const cacheNames = await caches.keys();
        
        if (cacheNames.length === 0) {
          log('âœ… No caches found', 'success');
          return;
        }

        log(`Found ${cacheNames.length} cache(s)`, 'info');
        
        for (const name of cacheNames) {
          await caches.delete(name);
          log(`âœ… Deleted cache: ${name}`, 'success');
        }
        
        log('âœ… All caches cleared!', 'success');
      } catch (error) {
        log(`âŒ Error: ${error.message}`, 'error');
      }
    }

    function reloadApp() {
      log('ðŸ”„ Reloading app in 2 seconds...', 'info');
      setTimeout(() => {
        window.location.href = '/';
      }, 2000);
    }

    // Auto-run on page load
    window.addEventListener('load', () => {
      log('Page loaded. Click buttons above or use DevTools:', 'info');
      log('F12 â†’ Application â†’ Service Workers â†’ Unregister', 'info');
    });
  </script>
</body>
</html>
